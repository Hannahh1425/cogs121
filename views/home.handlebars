
<!-- This is the Home view and will render into the main.hbs layout -->
<link rel="stylesheet" href="/style.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="/trends.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">



<script>
  $(document).ready(function() {
    $.ajax('/fetchData', {
      method: 'get'
    })
    .then(
      function success(json) {
        console.log("requesting to fetch data!");
        console.log("success");
        console.log(json.row);
        let rows = json.row;
        $.each(rows, function(i, item) {
          let icon = json.star;
          console.log("iconnn");
          console.log(icon[i]);
          let titleLike = 'title' + i;
          let contentLike = 'content' + i;
          let layoutLike = 'layout' + i;
          let hidetitle = rows[i].title;

          $(".all_articles").append('<div id="' + rows[i].id + '" class="article'+ i +' art"></div>');
          $("<button class=add_article id=" + i + " name=\"" + rows[i].title + "\" value=\"" + rows[i].link + "\"><i id=icon" + i + " class=\"" + icon[i] + "\"></i></button>" ).appendTo( '.article' + i);
          $('<div id=myModal' + i + ' class="hidden"><a href="/source"><u id=mark' + i + '>Bookmarked!</u></a></div>').appendTo('.article' + i);
          $('<a href="' + rows[i].link + '">'+rows[i].title+'</a>').appendTo( '.article' + i);
          // $('<h3 href="' + json[i].link + '">' + json[i].title + '</h3>').appendTo( '.article' + i);
          $("<p>" + rows[i].author + '&nbsp&nbsp&nbsp&nbsp&nbsp' + rows[i].reading_time +' min read '+'&nbsp&nbsp&nbsp&nbsp&nbsp'+rows[i].claps+ '&nbsp'+ 'claps'+ "</p>").appendTo( '.article' + i);
          // $("<button class=btnleft add_article name=\"" + json[i].title + "\" value=\"" + json[i].link + "\">Collect board</button>" ).appendTo( '.article' + i);
          $('<button class = "btneach btntitle" id = ' + titleLike + ' onclick="updateLikeTitle(' + rows[i].id + ')">Title  '+ '<i class="far fa-thumbs-up"></i>'+'&nbsp'+rows[i].like_title +'</button>' ).appendTo( '.article' + i);
          $('<button class = "btneach btncontent" id = ' + contentLike + ' onclick="updateLikeContent(' + rows[i].id + ')">Content  '+ '<i class="far fa-thumbs-up"></i>'+'&nbsp'+ rows[i].like_content +'</button>' ).appendTo( '.article' + i);
          $('<button class = "btneach btnlayout" id = ' + layoutLike + ' onclick="updateLikeLayout(' + rows[i].id + ')">Layout  '+ '<i class="far fa-thumbs-up"></i>'+'&nbsp'+rows[i].like_layout +'</button>' ).appendTo( '.article' + i);
          // $("<button class=add_article name=\"" + json[i].title + "\" value=\"" + json[i].link + "\">Add to mySource</button>" ).appendTo( '.article' + i);

        })
      },
      function fail(data, status) {
        console.log("fail");
        console.log(data);
        alert('Request failed.  Returned status of ' + status);
      }
    );
  });

  // updateLike = (id) => {
  //     $.ajax({
  //       url: '/updateLike',
  //       type: 'POST',
  //       dataType : 'json',
  //       // contentType: 'application/json',
  //       data: {
  //         article_id: id
  //       },
  //       success: (data) => {
  //         $('#status').html(data.message);
  //       }
  //     });
  //   }

  $('body').on('click', '.add_article', function (e) {
    console.log("clititlekkked");
    e.preventDefault();
    var title = this.name;
    var link = this.value;
    var id = this.id;
    console.log(id);

    $.ajax({
      // all URLs are relative to http://localhost:3000/
      url: '/bookmarks',
      type: 'POST', // <-- this is POST, not GET
      data: {
              title: title,
              link: link
            },
      success: (data) => {
        let modal = '#myModal' + id;
        let icon = '#icon' + id;
        $(icon).removeClass("far fa-star");
        $(icon).addClass("fas fa-star");
        console.log($('#myModal').attr("class"));
        $(modal).removeClass("hidden");
        $(modal).addClass("show_home");
        setTimeout(function() {
          $(modal).removeClass("show_home");
          $(modal).addClass("hidden");
        }, 2000);
      }
    });
  });

  $('body').on('mouseover', '.trend-data', function() {
    const id = this.id;
    $('#' + id).addClass("trend_animation");
  });

  $('body').on('mouseleave', '.trend-data', function() {
    const id = this.id;
    $('#' + id).removeClass("trend_animation");
  });


  updateLikeTitle = (id) => {
  $.ajax({
    url: '/updateLikeTitle',
    type: 'POST',
    dataType : 'json',

    data: {
      article_id: id
    },
    success: (data) => {

      let pass = '#title' + id;
      $(pass).html('Title  ' + '<i class="fas fa-thumbs-up"></i>'+'&nbsp'+data.newLikes);

      console.log("successfully reload idex.html")

    }

  });
}

updateLikeContent = (id) => {
  $.ajax({
    url: '/updateLikeContent',
    type: 'POST',
    dataType : 'json',

    data: {
      article_id: id
    },
    success: (data) => {

      let pass = '#content' + id;
      $(pass).html('Content  ' +'<i class="fas fa-thumbs-up"></i>'+'&nbsp'+ data.newLikes);

      console.log("successfully reload idex.html")

    }
  });
}

updateLikeLayout = (id) => {
  $.ajax({
    url: '/updateLikeLayout',
    type: 'POST',
    dataType : 'json',

    data: {
      article_id: id
    },
    success: (data) => {

      let pass = '#layout' + id;
      $(pass).html('Layout  ' + '<i class="fas fa-thumbs-up"></i>'+'&nbsp'+data.newLikes);

      console.log("successfully reload idex.html")

    }
  });
}



sort_title = () => {

  $.ajax({
    url: '/sort_by_title',
    type: 'POST',

  })
  .then(
    function success(json) {
      console.log("success0");
      console.log(json);
      $('.all_articles').empty();
      $.each(json, function(i, item) {

        let titleLike = 'title' + i;
        let contentLike = 'content' + i;
        let layoutLike = 'layout' + i;
        let hidetitle = json[i].title;

        $(".all_articles").append('<div id="' + json[i].id + '" class="article'+ i +' art"></div>');
        $("<button class=add_article id=" + i + " name=\"" + rows[i].title + "\" value=\"" + rows[i].link + "\"><i id=icon" + i + " class=\"" + icon[i] + "\"></i></button>" ).appendTo( '.article' + i);
        $('<div id=myModal' + i + ' class="hidden"><a href="/source"><u id=mark' + i + '>Bookmarked!</u></a></div>').appendTo('.article' + i);
        $('<a href="' + json[i].link + '">'+json[i].title+'</a>').appendTo( '.article' + i);
        $("<p>" + json[i].author + '&nbsp&nbsp&nbsp&nbsp&nbsp' + json[i].reading_time +' min read '+'&nbsp&nbsp&nbsp&nbsp&nbsp'+json[i].claps+ '&nbsp'+ 'claps'+ "</p>").appendTo( '.article' + i);
        $('<button class = "btneach btntitle" id = ' + titleLike + ' onclick="updateLikeTitle(' + json[i].id + ')">Title  '+ '<i class="far fa-thumbs-up"></i>'+'&nbsp'+json[i].like_title +'</button>' ).appendTo( '.article' + i);
        $('<button class = "btneach btncontent" id = ' + contentLike + ' onclick="updateLikeContent(' + json[i].id + ')">Content  '+ '<i class="far fa-thumbs-up"></i>'+'&nbsp'+ json[i].like_content +'</button>' ).appendTo( '.article' + i);
        $('<button class = "btneach btnlayout" id = ' + layoutLike + ' onclick="updateLikeLayout(' + json[i].id + ')">Layout  '+ '<i class="far fa-thumbs-up"></i>'+'&nbsp'+json[i].like_layout +'</button>' ).appendTo( '.article' + i);

      })
    },


    function fail(data, status) {
      console.log("fail");
      console.log(data);
      alert('Request failed.  Returned status of ' + status);
    }
  );

}

sort_content = () => {

  $.ajax({
    url: '/sort_by_content',
    type: 'POST',

  })
  .then(
    function success(json) {
      console.log("success0");
      console.log(json);
      $('.all_articles').empty();
      $.each(json, function(i, item) {

        let titleLike = 'title' + i;
        let contentLike = 'content' + i;
        let layoutLike = 'layout' + i;
        let hidetitle = json[i].title;

        $(".all_articles").append('<div id="' + json[i].id + '" class="article'+ i +' art"></div>');
        $("<button class=add_article id=" + i + " name=\"" + rows[i].title + "\" value=\"" + rows[i].link + "\"><i id=icon" + i + " class=\"" + icon[i] + "\"></i></button>" ).appendTo( '.article' + i);
        $('<div id=myModal' + i + ' class="hidden"><a href="/source"><u id=mark' + i + '>Bookmarked!</u></a></div>').appendTo('.article' + i);
        $('<a href="' + json[i].link + '">'+json[i].title+'</a>').appendTo( '.article' + i);
        $("<p>" + json[i].author + '&nbsp&nbsp&nbsp&nbsp&nbsp' + json[i].reading_time +' min read '+'&nbsp&nbsp&nbsp&nbsp&nbsp'+json[i].claps+ '&nbsp'+ 'claps'+ "</p>").appendTo( '.article' + i);


        $('<button class = "btneach btntitle" id = ' + titleLike + ' onclick="updateLikeTitle(' + json[i].id + ')">Title  '+ '<i class="far fa-thumbs-up"></i>'+'&nbsp'+json[i].like_title +'</button>' ).appendTo( '.article' + i);
        $('<button class = "btneach btncontent" id = ' + contentLike + ' onclick="updateLikeContent(' + json[i].id + ')">Content  '+ '<i class="far fa-thumbs-up"></i>'+'&nbsp'+ json[i].like_content +'</button>' ).appendTo( '.article' + i);
        $('<button class = "btneach btnlayout" id = ' + layoutLike + ' onclick="updateLikeLayout(' + json[i].id + ')">Layout  '+ '<i class="far fa-thumbs-up"></i>'+'&nbsp'+json[i].like_layout +'</button>' ).appendTo( '.article' + i);

      })
    },


    function fail(data, status) {
      console.log("fail");
      console.log(data);
      alert('Request failed.  Returned status of ' + status);
    }
  );


}


sort_layout = () => {

  $.ajax({
    url: '/sort_by_layout',
    type: 'POST',

  })
  .then(
    function success(json) {
      console.log("success0");
      console.log(json);
      $('.all_articles').empty();
      $.each(json, function(i, item) {

        let titleLike = 'title' + i;
        let contentLike = 'content' + i;
        let layoutLike = 'layout' + i;
        let hidetitle = json[i].title;

        $(".all_articles").append('<div id="' + json[i].id + '" class="article'+ i +' art"></div>');
        $("<button class=add_article id=" + i + " name=\"" + rows[i].title + "\" value=\"" + rows[i].link + "\"><i id=icon" + i + " class=\"" + icon[i] + "\"></i></button>" ).appendTo( '.article' + i);
        $('<div id=myModal' + i + ' class="hidden"><a href="/source"><u id=mark' + i + '>Bookmarked!</u></a></div>').appendTo('.article' + i);
        $('<a href="' + json[i].link + '">'+json[i].title+'</a>').appendTo( '.article' + i);
        $("<p>" + json[i].author + '&nbsp&nbsp&nbsp&nbsp&nbsp' + json[i].reading_time +' min read '+'&nbsp&nbsp&nbsp&nbsp&nbsp'+json[i].claps+ '&nbsp'+ 'claps'+ "</p>").appendTo( '.article' + i);


        $('<button class = "btneach btntitle" id = ' + titleLike + ' onclick="updateLikeTitle(' + json[i].id + ')">Title  '+ '<i class="far fa-thumbs-up"></i>'+'&nbsp'+json[i].like_title +'</button>' ).appendTo( '.article' + i);
        $('<button class = "btneach btncontent" id = ' + contentLike + ' onclick="updateLikeContent(' + json[i].id + ')">Content  '+ '<i class="far fa-thumbs-up"></i>'+'&nbsp'+ json[i].like_content +'</button>' ).appendTo( '.article' + i);
        $('<button class = "btneach btnlayout" id = ' + layoutLike + ' onclick="updateLikeLayout(' + json[i].id + ')">Layout  '+ '<i class="far fa-thumbs-up"></i>'+'&nbsp'+json[i].like_layout +'</button>' ).appendTo( '.article' + i);

      })
    },


    function fail(data, status) {
      console.log("fail");
      console.log(data);
      alert('Request failed.  Returned status of ' + status);
    }
  );


}

</script>

<!-- <script type="text/discourse-plugin" version="0.8">
      api.replaceIcon('fal fa-thumbs-up', 'fas fa-thumbs-up');
      // api.replaceIcon('d-unliked', 'thumbs-o-up');
      // api.replaceIcon('notification.liked', 'thumbs-o-up');
      // api.replaceIcon('notification.liked_2', 'thumbs-o-up');
      // api.replaceIcon('notification.liked_many', 'thumbs-o-up');
      // api.replaceIcon('heart', 'thumbs-up');
</script> -->

{{> header}}
<div class="content">
<div class="banner vh-100">
  <h1>Landing</h1>
  <p style="font-size: 40px; font-family: Georgia, Times, Times New Roman, serif; font-style: italic">Pack your way of We Media writing</p>
  <!-- <p style="font-size: 25px;font-weight:600;"> ✶ &nbsp Latest trends &nbsp<br/> ✶ &nbsp  Heated topic&nbsp <br/> ✶ &nbsp  Useful writing skills&nbsp
     <br/>✶ &nbsp Large database of successful articles.<p2> -->



</div>
<div class="trend">
    <h1>Today's Trends</h1>
    <p>Get everyday's hot topic at the earliest time. Refresh every hour.</p>
    <div class="container">
      {{#each tag as |tag index|}}
        <button class="trend-data" id="tag{{index}}" name="{{tag}}">{{tag}}</button>
      {{/each}}
    </div>

</hr>
</div>

<div class="article_container">
  <h1>Articles Sources</h1>
  <!-- Filter button -->

  <div class="dropdown">
    <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Filter by
    <span class="caret"></span></button>
    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
      <li><a class="dropdown-item" onclick = "sort_title()">Good title</a></li>
      <li><a class="dropdown-item" onclick = "sort_content()">Good content</a></li>
      <li><a class="dropdown-item" onclick = "sort_layout()">Good layout</a></li>
    </ul>
  </div>

  <div class="all_articles" id = "status"></div>
</div>

</div>
